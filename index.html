

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Renamer</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.4.120/build/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --primary-light: #4895ef;
            --primary-dark: #3f37c9;
            --secondary: #4cc9f0;
            --success: #4ade80;
            --danger: #f87171;
            --warning: #fbbf24;
            --info: #60a5fa;
            --background: #f8fafc;
            --surface: #ffffff;
            --text: #1e293b;
            --text-light: #64748b;
            --border: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius: 0.5rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background);
            color: var(--text);
            line-height: 1.5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        header {
            background-color: var(--surface);
            box-shadow: var(--shadow-sm);
            padding: 1.5rem 0;
            margin-bottom: 2rem;
        }

        header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 0;
            padding-bottom: 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--primary);
        }

        .logo svg {
            width: 2rem;
            height: 2rem;
        }

        .app-version {
            font-size: 0.875rem;
            color: var(--text-light);
            font-weight: 500;
        }

        .card {
            background-color: var(--surface);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 2rem;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }

        .card-header {
            margin-bottom: 1.5rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-title .step {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            font-size: 1rem;
            font-weight: 600;
        }

        .card-description {
            margin-top: 0.5rem;
            color: var(--text-light);
        }

        .file-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            border: 2px dashed var(--border);
            border-radius: var(--radius);
            background-color: rgba(0, 0, 0, 0.01);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-upload:hover {
            border-color: var(--primary-light);
            background-color: rgba(67, 97, 238, 0.05);
        }

        .file-upload svg {
            width: 3rem;
            height: 3rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .file-upload-text {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .file-upload-hint {
            font-size: 0.875rem;
            color: var(--text-light);
        }

        .file-input {
            display: none;
        }

        .file-info {
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: rgba(0, 0, 0, 0.02);
            border-radius: var(--radius);
            display: none;
        }

        .file-info.active {
            display: block;
        }

        .file-info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .file-info-label {
            font-weight: 500;
            color: var(--text);
        }

        .file-info-value {
            color: var(--text-light);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
            outline: none;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .btn-secondary {
            background-color: var(--border);
            color: var(--text);
        }

        .btn-secondary:hover {
            background-color: #d1d5db;
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-success:hover {
            background-color: #22c55e;
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background-color: #ef4444;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn svg {
            width: 1rem;
            height: 1rem;
        }

        .btn-group {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.875rem;
        }

        .form-control {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 0.875rem;
            transition: all 0.2s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.15);
        }

        .form-text {
            margin-top: 0.5rem;
            font-size: 0.75rem;
            color: var(--text-light);
        }

        .option-group {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .option-card {
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .option-card:hover {
            border-color: var(--primary-light);
            background-color: rgba(67, 97, 238, 0.05);
        }

        .option-card.selected {
            border-color: var(--primary);
            background-color: rgba(67, 97, 238, 0.1);
        }

        .option-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .option-radio {
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid var(--border);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .option-card.selected .option-radio {
            border-color: var(--primary);
        }

        .option-card.selected .option-radio::after {
            content: "";
            width: 0.625rem;
            height: 0.625rem;
            border-radius: 50%;
            background-color: var(--primary);
        }

        .option-title {
            font-weight: 500;
        }

        .option-description {
            font-size: 0.875rem;
            color: var(--text-light);
            margin-left: 2rem;
        }

        .option-content {
            margin-top: 1rem;
            margin-left: 2rem;
            display: none;
        }

        .option-card.selected .option-content {
            display: block;
        }

        .range-inputs {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .range-inputs .form-control {
            width: 5rem;
        }

        .range-separator {
            color: var(--text-light);
        }

        .pdf-preview-container {
            margin-top: 1.5rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
        }

        .pdf-toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            background-color: #f1f5f9;
            border-bottom: 1px solid var(--border);
        }

        .pdf-pagination {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .pdf-page-info {
            font-size: 0.875rem;
            color: var(--text);
        }

        .pdf-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
            border-radius: var(--radius);
            background-color: white;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .pdf-btn:hover {
            background-color: #f8fafc;
        }

        .pdf-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pdf-btn svg {
            width: 1rem;
            height: 1rem;
            color: var(--text);
        }

        .pdf-canvas-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
            background-color: #f1f5f9;
            position: relative;
            overflow: hidden;
        }

        #pdfCanvas {
            max-width: 100%;
            box-shadow: var(--shadow);
        }

        .selection-overlay {
            position: absolute;
            border: 2px dashed var(--primary);
            background-color: rgba(67, 97, 238, 0.1);
            pointer-events: none;
            z-index: 10;
        }

        .selection-instructions {
            position: absolute;
            top: 1rem;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            font-size: 0.875rem;
            z-index: 20;
        }

        .extracted-text {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #f1f5f9;
            border-radius: var(--radius);
            font-size: 0.875rem;
        }

        .extracted-text-label {
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .extracted-text-value {
            font-family: monospace;
            padding: 0.5rem;
            background-color: white;
            border: 1px solid var(--border);
            border-radius: 0.25rem;
            word-break: break-all;
        }

        .progress-container {
            margin-top: 1.5rem;
        }

        .progress-bar {
            height: 0.5rem;
            background-color: #e2e8f0;
            border-radius: 1rem;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--primary);
            width: 0%;
            transition: width 0.3s ease;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
            font-size: 0.875rem;
            color: var(--text-light);
        }

        .alert {
            padding: 1rem;
            border-radius: var(--radius);
            margin-bottom: 1.5rem;
            font-size: 0.875rem;
        }

        .alert-info {
            background-color: rgba(96, 165, 250, 0.1);
            border-left: 4px solid var(--info);
            color: #1e40af;
        }

        .alert-success {
            background-color: rgba(74, 222, 128, 0.1);
            border-left: 4px solid var(--success);
            color: #15803d;
        }

        .alert-warning {
            background-color: rgba(251, 191, 36, 0.1);
            border-left: 4px solid var(--warning);
            color: #b45309;
        }

        .alert-danger {
            background-color: rgba(248, 113, 113, 0.1);
            border-left: 4px solid var(--danger);
            color: #b91c1c;
        }

        .result-files {
            margin-top: 1.5rem;
        }

        .result-file {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .result-file-name {
            font-weight: 500;
        }

        .result-file-pages {
            color: var(--text-light);
        }

        footer {
            margin-top: auto;
            padding: 2rem 0;
            background-color: var(--surface);
            border-top: 1px solid var(--border);
        }

        footer .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 0;
            padding-bottom: 0;
        }

        .footer-text {
            font-size: 0.875rem;
            color: var(--text-light);
        }

        .footer-links {
            display: flex;
            gap: 1.5rem;
        }

        .footer-link {
            font-size: 0.875rem;
            color: var(--primary);
            text-decoration: none;
        }

        .footer-link:hover {
            text-decoration: underline;
        }

        .hidden {
            display: none !important;
        }

        /* Estilos para download individual */
        .download-individual {
            margin-left: 0.5rem;
            color: var(--primary);
            cursor: pointer;
        }

        .download-individual:hover {
            text-decoration: underline;
        }

        /* Estilos para o modal de debug */
        .debug-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .debug-modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: var(--radius);
            max-width: 80%;
            max-height: 80%;
            overflow: auto;
        }

        .debug-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .card {
                padding: 1.5rem;
            }

            .btn-group {
                flex-direction: column;
            }

            .range-inputs {
                flex-direction: column;
                align-items: flex-start;
            }

            .range-inputs .form-control {
                width: 100%;
            }

            footer .container {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M21 8.94V5.94C21 4.84 20.11 3.94 19 3.94H14.5C14.19 3.94 13.89 4.04 13.65 4.23L12.05 5.53L10.45 4.23C10.21 4.04 9.91 3.94 9.5 3.94H5C3.9 3.94 3 4.84 3 5.94V19.94C3 21.04 3.9 21.94 5 21.94H9.5C9.81 21.94 10.11 21.84 10.35 21.65L12 20.33L13.65 21.65C13.89 21.84 14.19 21.94 14.5 21.94H19C20.11 21.94 21 21.04 21 19.94V16.94" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M14.5 3.93V12.93L12 10.93L9.5 12.93V3.93" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                PDF Renamer
            </div>
            <div class="app-version">v1.2.0</div>
        </div>
    </header>

    <main class="container">
        <!-- Step 1: Upload PDF -->
        <div id="step1" class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <span class="step">1</span>
                    Selecione um arquivo PDF
                </h2>
                <p class="card-description">
                    Faça upload do arquivo PDF que contém os documentos que você deseja renomear.
                </p>
            </div>

            <label for="pdfFile" class="file-upload">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 3v4a1 1 0 0 0 1 1h4"></path>
                    <path d="M17 21H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7l5 5v11a2 2 0 0 1-2 2z"></path>
                    <path d="M12 11v6"></path>
                    <path d="M9 14h6"></path>
                </svg>
                <div class="file-upload-text">Clique para selecionar um arquivo PDF</div>
                <div class="file-upload-hint">ou arraste e solte aqui</div>
                <input type="file" id="pdfFile" class="file-input" accept=".pdf">
            </label>

            <div id="fileInfo" class="file-info">
                <div class="file-info-item">
                    <span class="file-info-label">Nome do arquivo:</span>
                    <span id="fileName" class="file-info-value">-</span>
                </div>
                <div class="file-info-item">
                    <span class="file-info-label">Tamanho:</span>
                    <span id="fileSize" class="file-info-value">-</span>
                </div>
                <div class="file-info-item">
                    <span class="file-info-label">Páginas:</span>
                    <span id="filePages" class="file-info-value">-</span>
                </div>
            </div>

            <div class="btn-group">
                <button id="continueToStep2" class="btn btn-primary" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M5 12h14"></path>
                        <path d="m12 5 7 7-7 7"></path>
                    </svg>
                    Continuar
                </button>
            </div>
        </div>

        <!-- Step 2: Configure Document Structure -->
        <div id="step2" class="card hidden">
            <div class="card-header">
                <h2 class="card-title">
                    <span class="step">2</span>
                    Configure a estrutura do documento
                </h2>
                <p class="card-description">
                    Defina como as páginas estão organizadas no seu documento.
                </p>
            </div>

            <div class="form-group">
                <label for="pagesPerDocument" class="form-label">Páginas por documento</label>
                <input type="number" id="pagesPerDocument" class="form-control" min="1" value="1">
                <div class="form-text">
                    Quantas páginas cada documento (ex: funcionário) ocupa no PDF? Por exemplo, se cada funcionário tem 3 páginas, digite 3.
                </div>
            </div>

            <div class="form-group">
                <label for="textPageNumber" class="form-label">Página onde está o texto para extração</label>
                <input type="number" id="textPageNumber" class="form-control" min="1" value="1">
                <div class="form-text">
                    Em qual página de cada documento está o texto que você deseja extrair para o nome do arquivo? (1 = primeira página de cada documento)
                </div>
            </div>

            <div class="alert alert-info">
                <strong>Exemplo:</strong> Se você tem um PDF com 15 páginas, onde cada funcionário ocupa 3 páginas, e o nome está sempre na primeira página de cada funcionário, configure "Páginas por documento" = 3 e "Página onde está o texto" = 1.
            </div>

            <div class="btn-group">
                <button id="backToStep1" class="btn btn-secondary">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m15 18-6-6 6-6"></path>
                    </svg>
                    Voltar
                </button>
                <button id="continueToStep3" class="btn btn-primary">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M5 12h14"></path>
                        <path d="m12 5 7 7-7 7"></path>
                    </svg>
                    Continuar
                </button>
            </div>
        </div>

        <!-- Step 3: Select Text Field -->
        <div id="step3" class="card hidden">
            <div class="card-header">
                <h2 class="card-title">
                    <span class="step">3</span>
                    Selecione o campo de texto
                </h2>
                <p class="card-description">
                    Selecione a área que contém o texto para nomear os arquivos.
                </p>
            </div>

            <div class="alert alert-info">
                Navegue até a primeira página do primeiro documento e selecione a área que contém o texto para nomear os arquivos.
                O sistema usará esta mesma área para extrair texto de todos os documentos.
            </div>

            <div class="pdf-preview-container">
                <div class="pdf-toolbar">
                    <div class="pdf-pagination">
                        <button id="prevPage" class="pdf-btn" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="m15 18-6-6 6-6"></path>
                            </svg>
                        </button>
                        <span id="pageInfo" class="pdf-page-info">Página 1 de 1</span>
                        <button id="nextPage" class="pdf-btn" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="m9 18 6-6-6-6"></path>
                            </svg>
                        </button>
                    </div>
                    <div class="pdf-zoom">
                        <button id="zoomOut" class="pdf-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 21l-6-6m-2 5a7 7 0 1 1 0-14 7 7 0 0 1 0 14zM10 10h4"></path>
                            </svg>
                        </button>
                        <button id="zoomIn" class="pdf-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 21l-6-6m-2 5a7 7 0 1 1 0-14 7 7 0 0 1 0 14zM10 10h4M12 8v4"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div id="pdfCanvasContainer" class="pdf-canvas-container">
                    <canvas id="pdfCanvas"></canvas>
                    <div id="selectionOverlay" class="selection-overlay hidden"></div>
                    <div id="selectionInstructions" class="selection-instructions">
                        Clique e arraste para selecionar o texto
                    </div>
                </div>
            </div>

            <div id="extractedTextContainer" class="extracted-text hidden">
                <div class="extracted-text-label">Texto extraído (exemplo do primeiro documento):</div>
                <div id="extractedText" class="extracted-text-value">-</div>
            </div>

            <div class="form-group">
                <label for="filenamePattern" class="form-label">Padrão de nome de arquivo</label>
                <input type="text" id="filenamePattern" class="form-control" value="{text}_pagina{page}">
                <div class="form-text">
                    Use {text} para o texto extraído e {page} para o número da página dentro do documento.
                </div>
            </div>

            <div class="btn-group">
                <button id="backToStep2" class="btn btn-secondary">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m15 18-6-6 6-6"></path>
                    </svg>
                    Voltar
                </button>
                <button id="continueToStep4" class="btn btn-primary" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M5 12h14"></path>
                        <path d="m12 5 7 7-7 7"></path>
                    </svg>
                    Continuar
                </button>
            </div>
        </div>

        <!-- Step 4: Processing -->
        <div id="step4" class="card hidden">
            <div class="card-header">
                <h2 class="card-title">
                    <span class="step">4</span>
                    Processando PDF
                </h2>
                <p class="card-description">
                    Aguarde enquanto processamos seu arquivo PDF.
                </p>
            </div>

            <div class="progress-container">
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill"></div>
                </div>
                <div class="progress-info">
                    <span id="progressText">Preparando...</span>
                    <span id="progressPercent">0%</span>
                </div>
            </div>

            <div class="alert alert-warning">
                Por favor, não feche esta janela enquanto o processamento estiver em andamento.
            </div>
        </div>

        <!-- Step 5: Download -->
        <div id="step5" class="card hidden">
            <div class="card-header">
                <h2 class="card-title">
                    <span class="step">5</span>
                    Download
                </h2>
                <p class="card-description">
                    Seu PDF foi processado com sucesso. Você pode baixar os arquivos agora.
                </p>
            </div>

            <div id="processingSuccess" class="alert alert-success">
                O processamento foi concluído com sucesso! Os arquivos estão prontos para download.
            </div>

            <div id="processingError" class="alert alert-danger hidden">
                Ocorreu um erro durante o processamento. Por favor, tente novamente.
            </div>

            <div id="resultFiles" class="result-files">
                <!-- Result files will be listed here -->
            </div>

            <div class="btn-group">
                <button id="startOver" class="btn btn-secondary">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
                        <path d="M3 3v5h5"></path>
                    </svg>
                    Processar outro PDF
                </button>
                <button id="downloadZip" class="btn btn-success">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Baixar todos os arquivos (ZIP)
                </button>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-text">
                &copy; 2023 PDF Renamer - Todos os direitos reservados
            </div>
            <div class="footer-links">
                <a href="#" class="footer-link">Sobre</a>
                <a href="#" class="footer-link">Ajuda</a>
                <a href="#" class="footer-link">Contato</a>
            </div>
        </div>
    </footer>

    <script>
        // Verificar se o documento está pronto
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Documento carregado. Inicializando aplicação...');
            initApp();
        });

        function initApp() {
            // Configurar o worker do PDF.js
            if (typeof pdfjsLib !== 'undefined') {
                console.log('PDF.js detectado. Configurando worker...');
                pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.4.120/build/pdf.worker.min.js';
            } else {
                console.error('PDF.js não foi carregado corretamente!');
                showError('Erro ao carregar bibliotecas necessárias. Por favor, recarregue a página.');
                return;
            }

            // Elementos da interface
            const pdfFileInput = document.getElementById('pdfFile');
            const fileInfo = document.getElementById('fileInfo');
            const fileName = document.getElementById('fileName');
            const fileSize = document.getElementById('fileSize');
            const filePages = document.getElementById('filePages');
            const continueToStep2 = document.getElementById('continueToStep2');
            const backToStep1 = document.getElementById('backToStep1');
            const continueToStep3 = document.getElementById('continueToStep3');
            const backToStep2 = document.getElementById('backToStep2');
            const continueToStep4 = document.getElementById('continueToStep4');
            const pagesPerDocumentInput = document.getElementById('pagesPerDocument');
            const textPageNumberInput = document.getElementById('textPageNumber');
            const pdfCanvas = document.getElementById('pdfCanvas');
            const pdfCanvasContainer = document.getElementById('pdfCanvasContainer');
            const selectionOverlay = document.getElementById('selectionOverlay');
            const selectionInstructions = document.getElementById('selectionInstructions');
            const extractedTextContainer = document.getElementById('extractedTextContainer');
            const extractedText = document.getElementById('extractedText');
            const filenamePattern = document.getElementById('filenamePattern');
            const prevPageBtn = document.getElementById('prevPage');
            const nextPageBtn = document.getElementById('nextPage');
            const pageInfo = document.getElementById('pageInfo');
            const zoomInBtn = document.getElementById('zoomIn');
            const zoomOutBtn = document.getElementById('zoomOut');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            const progressPercent = document.getElementById('progressPercent');
            const processingSuccess = document.getElementById('processingSuccess');
            const processingError = document.getElementById('processingError');
            const resultFiles = document.getElementById('resultFiles');
            const startOverBtn = document.getElementById('startOver');
            const downloadZipBtn = document.getElementById('downloadZip');

            // Etapas
            const step1 = document.getElementById('step1');
            const step2 = document.getElementById('step2');
            const step3 = document.getElementById('step3');
            const step4 = document.getElementById('step4');
            const step5 = document.getElementById('step5');

            // Variáveis globais
            let pdfDoc = null;
            let pdfBytes = null; // Armazenar os bytes do PDF original
            let currentPage = 1;
            let totalPages = 0;
            let scale = 1.5;
            let selectionActive = false;
            let startX, startY, endX, endY;
            let selectionCoordinates = null;
            let canvasRect;
            let processedFiles = [];
            let pdfBlobs = {}; // Armazenar blobs de PDF por nome de arquivo
            let zip = null;

            // Verificar se as bibliotecas necessárias estão carregadas
            if (typeof JSZip === 'undefined') {
                console.error('JSZip não foi carregado corretamente!');
                showError('Erro ao carregar bibliotecas necessárias. Por favor, recarregue a página.');
                return;
            }

            if (typeof saveAs === 'undefined') {
                console.error('FileSaver não foi carregado corretamente!');
                showError('Erro ao carregar bibliotecas necessárias. Por favor, recarregue a página.');
                return;
            }

            // Inicializar o JSZip
            try {
                zip = new JSZip();
                console.log('JSZip inicializado com sucesso');
            } catch (error) {
                console.error('Erro ao inicializar JSZip:', error);
                showError('Erro ao inicializar componentes necessários. Por favor, recarregue a página.');
                return;
            }

            // Evento de seleção de arquivo
            pdfFileInput.addEventListener('change', handleFileSelect);

            // Drag and drop para o upload de arquivo
            const fileUpload = document.querySelector('.file-upload');
            
            fileUpload.addEventListener('dragover', (e) => {
                e.preventDefault();
                fileUpload.style.borderColor = 'var(--primary)';
                fileUpload.style.backgroundColor = 'rgba(67, 97, 238, 0.1)';
            });
            
            fileUpload.addEventListener('dragleave', (e) => {
                e.preventDefault();
                fileUpload.style.borderColor = 'var(--border)';
                fileUpload.style.backgroundColor = 'rgba(0, 0, 0, 0.01)';
            });
            
            fileUpload.addEventListener('drop', (e) => {
                e.preventDefault();
                fileUpload.style.borderColor = 'var(--border)';
                fileUpload.style.backgroundColor = 'rgba(0, 0, 0, 0.01)';
                
                if (e.dataTransfer.files.length > 0) {
                    pdfFileInput.files = e.dataTransfer.files;
                    handleFileSelect();
                }
            });

            // Navegação entre etapas
            continueToStep2.addEventListener('click', () => {
                step1.classList.add('hidden');
                step2.classList.remove('hidden');
            });

            backToStep1.addEventListener('click', () => {
                step2.classList.add('hidden');
                step1.classList.remove('hidden');
            });

            continueToStep3.addEventListener('click', () => {
                const pagesPerDocument = parseInt(pagesPerDocumentInput.value);
                const textPageNumber = parseInt(textPageNumberInput.value);
                
                if (isNaN(pagesPerDocument) || pagesPerDocument < 1) {
                    alert('Por favor, insira um número válido de páginas por documento.');
                    return;
                }
                
                if (isNaN(textPageNumber) || textPageNumber < 1 || textPageNumber > pagesPerDocument) {
                    alert(`Por favor, insira um número de página válido entre 1 e ${pagesPerDocument}.`);
                    return;
                }
                
                step2.classList.add('hidden');
                step3.classList.remove('hidden');
                
                // Calcular a primeira página do primeiro documento
                const firstDocPage = 1 + (textPageNumber - 1);
                currentPage = firstDocPage;
                
                renderPdfPage(currentPage);
            });

            backToStep2.addEventListener('click', () => {
                step3.classList.add('hidden');
                step2.classList.remove('hidden');
            });

            continueToStep4.addEventListener('click', () => {
                step3.classList.add('hidden');
                step4.classList.remove('hidden');
                processPdf();
            });

            startOverBtn.addEventListener('click', () => {
                resetApp();
                step5.classList.add('hidden');
                step1.classList.remove('hidden');
            });

            // Navegação do PDF
            prevPageBtn.addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    renderPdfPage(currentPage);
                }
            });

            nextPageBtn.addEventListener('click', () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    renderPdfPage(currentPage);
                }
            });

            // Zoom do PDF
            zoomInBtn.addEventListener('click', () => {
                scale += 0.25;
                renderPdfPage(currentPage);
            });

            zoomOutBtn.addEventListener('click', () => {
                if (scale > 0.5) {
                    scale -= 0.25;
                    renderPdfPage(currentPage);
                }
            });

            // Download do ZIP
            downloadZipBtn.addEventListener('click', downloadZip);

            // Validação de inputs numéricos
            pagesPerDocumentInput.addEventListener('input', validatePagesPerDocument);
            textPageNumberInput.addEventListener('input', validateTextPageNumber);

            function validatePagesPerDocument() {
                const pagesPerDocument = parseInt(pagesPerDocumentInput.value);
                if (isNaN(pagesPerDocument) || pagesPerDocument < 1) {
                    pagesPerDocumentInput.setCustomValidity('Insira um número válido maior que 0');
                } else if (pagesPerDocument > totalPages) {
                    pagesPerDocumentInput.setCustomValidity(`O valor não pode ser maior que o total de páginas (${totalPages})`);
                } else {
                    pagesPerDocumentInput.setCustomValidity('');
                    
                    // Atualizar o valor máximo para o campo de página de texto
                    textPageNumberInput.max = pagesPerDocument;
                    validateTextPageNumber();
                }
            }

            function validateTextPageNumber() {
                const pagesPerDocument = parseInt(pagesPerDocumentInput.value);
                const textPageNumber = parseInt(textPageNumberInput.value);
                
                if (isNaN(textPageNumber) || textPageNumber < 1) {
                    textPageNumberInput.setCustomValidity('Insira um número válido maior que 0');
                } else if (textPageNumber > pagesPerDocument) {
                    textPageNumberInput.setCustomValidity(`O valor não pode ser maior que o número de páginas por documento (${pagesPerDocument})`);
                } else {
                    textPageNumberInput.setCustomValidity('');
                }
            }

            // Função para lidar com a seleção de arquivo
            function handleFileSelect() {
                if (pdfFileInput.files.length === 0) {
                    return;
                }

                const file = pdfFileInput.files[0];
                if (file.type !== 'application/pdf') {
                    alert('Por favor, selecione um arquivo PDF válido.');
                    return;
                }

                fileName.textContent = file.name;
                fileSize.textContent = formatFileSize(file.size);
                filePages.textContent = 'Carregando...';
                fileInfo.classList.add('active');

                const fileReader = new FileReader();
                fileReader.onload = async function() {
                    try {
                        // Armazenar os bytes do PDF original
                        pdfBytes = new Uint8Array(fileReader.result);
                        
                        // Verificar se os dados são válidos
                        if (!pdfBytes || pdfBytes.length < 10) {
                            throw new Error("O arquivo PDF parece estar corrompido ou vazio");
                        }
                        
                        console.log(`PDF carregado: ${pdfBytes.length} bytes`);
                        
                        // Carregar o PDF com PDF.js
                        try {
                            pdfDoc = await pdfjsLib.getDocument({data: pdfBytes}).promise;
                            totalPages = pdfDoc.numPages;
                            filePages.textContent = `${totalPages} páginas`;
                            
                            // Habilitar o botão de continuar
                            continueToStep2.disabled = false;
                            
                            // Configurar valores máximos
                            pagesPerDocumentInput.max = totalPages;
                            validatePagesPerDocument();
                            
                            console.log(`PDF carregado com sucesso: ${totalPages} páginas`);
                        } catch (e) {
                            console.error("Erro ao carregar PDF com PDF.js:", e);
                            throw new Error("Não foi possível processar este PDF. Por favor, tente com outro arquivo.");
                        }
                    } catch (error) {
                        console.error('Erro ao carregar o PDF:', error);
                        alert(error.message || 'Não foi possível carregar o PDF. Verifique se o arquivo é válido.');
                        filePages.textContent = 'Erro ao carregar o arquivo';
                        continueToStep2.disabled = true;
                    }
                };
                
                fileReader.onerror = function() {
                    console.error('Erro ao ler o arquivo');
                    alert('Erro ao ler o arquivo. Por favor, tente novamente.');
                    filePages.textContent = '';
                    continueToStep2.disabled = true;
                };
                
                fileReader.readAsArrayBuffer(file);
            }

            // Função para renderizar uma página do PDF
            async function renderPdfPage(pageNumber) {
                try {
                    // Atualizar informações da página
                    pageInfo.textContent = `Página ${pageNumber} de ${totalPages}`;
                    
                    // Habilitar/desabilitar botões de navegação
                    prevPageBtn.disabled = pageNumber <= 1;
                    nextPageBtn.disabled = pageNumber >= totalPages;
                    
                    // Obter a página
                    const page = await pdfDoc.getPage(pageNumber);
                    
                    // Calcular dimensões
                    const viewport = page.getViewport({ scale });
                    pdfCanvas.width = viewport.width;
                    pdfCanvas.height = viewport.height;
                    
                    // Renderizar a página
                    const renderContext = {
                        canvasContext: pdfCanvas.getContext('2d'),
                        viewport: viewport
                    };
                    
                    await page.render(renderContext).promise;
                    
                    // Atualizar o retângulo do canvas para seleção
                    canvasRect = pdfCanvas.getBoundingClientRect();
                    
                    // Limpar seleção anterior se estiver mudando de página
                    if (selectionCoordinates) {
                        // Mostrar a seleção existente na nova página
                        showSelectionOverlay(selectionCoordinates);
                    } else {
                        clearSelection();
                    }
                } catch (error) {
                    console.error('Erro ao renderizar página:', error);
                    alert('Erro ao renderizar a página do PDF.');
                }
            }

            // Eventos para seleção de texto
            pdfCanvasContainer.addEventListener('mousedown', startSelection);
            pdfCanvasContainer.addEventListener('mousemove', updateSelection);
            pdfCanvasContainer.addEventListener('mouseup', endSelection);
            pdfCanvasContainer.addEventListener('mouseleave', () => {
                if (selectionActive) {
                    endSelection();
                }
            });

            // Função para iniciar a seleção
            function startSelection(e) {
                selectionActive = true;
                
                // Calcular posição relativa ao canvas
                const rect = pdfCanvas.getBoundingClientRect();
                startX = e.clientX - rect.left;
                startY = e.clientY - rect.top;
                
                // Mostrar overlay
                selectionOverlay.style.left = `${startX}px`;
                selectionOverlay.style.top = `${startY}px`;
                selectionOverlay.style.width = '0px';
                selectionOverlay.style.height = '0px';
                selectionOverlay.classList.remove('hidden');
            }

            // Função para atualizar a seleção
            function updateSelection(e) {
                if (!selectionActive) return;
                
                // Calcular posição relativa ao canvas
                const rect = pdfCanvas.getBoundingClientRect();
                endX = e.clientX - rect.left;
                endY = e.clientY - rect.top;
                
                // Calcular dimensões
                const width = Math.abs(endX - startX);
                const height = Math.abs(endY - startY);
                
                // Calcular posição do canto superior esquerdo
                const left = Math.min(startX, endX);
                const top = Math.min(startY, endY);
                
                // Atualizar overlay
                selectionOverlay.style.left = `${left}px`;
                selectionOverlay.style.top = `${top}px`;
                selectionOverlay.style.width = `${width}px`;
                selectionOverlay.style.height = `${height}px`;
            }

            // Função para finalizar a seleção
            async function endSelection() {
                if (!selectionActive) return;
                selectionActive = false;
                
                // Verificar se a seleção é válida
                const width = Math.abs(endX - startX);
                const height = Math.abs(endY - startY);
                
                if (width < 10 || height < 10) {
                    clearSelection();
                    return;
                }
                
                try {
                    // Salvar coordenadas da seleção
                    selectionCoordinates = {
                        left: Math.min(startX, endX) / scale,
                        top: Math.min(startY, endY) / scale,
                        right: Math.max(startX, endX) / scale,
                        bottom: Math.max(startY, endY) / scale
                    };
                    
                    // Extrair texto da área selecionada
                    const extractedTextValue = await extractTextFromSelection(currentPage, selectionCoordinates);
                    
                    if (extractedTextValue) {
                        document.getElementById('extractedText').textContent = extractedTextValue;
                        extractedTextContainer.classList.remove('hidden');
                        continueToStep4.disabled = false;
                    } else {
                        alert('Nenhum texto foi encontrado na área selecionada. Por favor, tente novamente.');
                        clearSelection();
                    }
                } catch (error) {
                    console.error('Erro ao extrair texto:', error);
                    alert('Erro ao extrair texto da área selecionada.');
                    clearSelection();
                }
            }

            // Função para extrair texto da seleção
            async function extractTextFromSelection(pageNum, coordinates) {
                try {
                    const page = await pdfDoc.getPage(pageNum);
                    const viewport = page.getViewport({ scale: 1.0 }); // Escala 1.0 para coordenadas reais
                    
                    // Inverter coordenadas Y (PDF tem origem no canto inferior esquerdo)
                    const pdfTop = viewport.height - coordinates.bottom;
                    const pdfBottom = viewport.height - coordinates.top;
                    
                    // Extrair texto
                    const textContent = await page.getTextContent();
                    let extractedText = '';
                    
                    for (const item of textContent.items) {
                        const tx = item.transform[4];
                        const ty = item.transform[5];
                        
                        // Verificar se o item está dentro da área selecionada
                        if (tx >= coordinates.left && tx <= coordinates.right && ty >= pdfTop && ty <= pdfBottom) {
                            extractedText += item.str + ' ';
                        }
                    }
                    
                    return extractedText.trim();
                } catch (error) {
                    console.error('Erro ao extrair texto:', error);
                    throw error;
                }
            }

            // Função para mostrar a seleção existente
            function showSelectionOverlay(coordinates) {
                // Converter coordenadas do PDF para coordenadas do canvas
                const left = coordinates.left * scale;
                const top = coordinates.top * scale;
                const width = (coordinates.right - coordinates.left) * scale;
                const height = (coordinates.bottom - coordinates.top) * scale;
                
                // Atualizar overlay
                selectionOverlay.style.left = `${left}px`;
                selectionOverlay.style.top = `${top}px`;
                selectionOverlay.style.width = `${width}px`;
                selectionOverlay.style.height = `${height}px`;
                selectionOverlay.classList.remove('hidden');
            }

            // Função para limpar a seleção
            function clearSelection() {
                selectionOverlay.classList.add('hidden');
                selectionCoordinates = null;
                continueToStep4.disabled = true;
                extractedTextContainer.classList.add('hidden');
            }

            // Função para processar o PDF
            async function processPdf() {
                try {
                    console.log('Iniciando processamento do PDF...');
                    
                    // Verificar se temos os bytes do PDF
                    if (!pdfBytes || pdfBytes.length === 0) {
                        throw new Error("Dados do PDF não estão disponíveis. Por favor, recarregue a página e tente novamente.");
                    }
                    
                    // Obter configurações
                    const pagesPerDocument = parseInt(pagesPerDocumentInput.value);
                    const textPageOffset = parseInt(textPageNumberInput.value) - 1; // Converter para índice baseado em 0
                    
                    // Calcular número de documentos
                    const numDocuments = Math.ceil(totalPages / pagesPerDocument);
                    console.log(`Total de páginas: ${totalPages}, Páginas por documento: ${pagesPerDocument}, Total de documentos: ${numDocuments}`);
                    
                    // Resetar variáveis
                    processedFiles = [];
                    pdfBlobs = {};
                    zip = new JSZip();
                    
                    // Pré-carregar o PDF com PDF-LIB para processamento
                    console.log("Carregando PDF com PDF-LIB...");
                    const { PDFDocument } = PDFLib;
                    let originalPdfDoc;
                    
                    try {
                        // Converter Uint8Array para ArrayBuffer se necessário
                        const arrayBuffer = pdfBytes.buffer || pdfBytes;
                        originalPdfDoc = await PDFDocument.load(arrayBuffer);
                        console.log("PDF carregado com sucesso no PDF-LIB");
                    } catch (error) {
                        console.error("Erro ao carregar PDF com PDF-LIB:", error);
                        throw new Error("Não foi possível processar o PDF. Erro: " + error.message);
                    }
                    
                    // Processar cada documento
                    for (let docIndex = 0; docIndex < numDocuments; docIndex++) {
                        // Calcular páginas para este documento
                        const startPage = docIndex * pagesPerDocument + 1; // Página inicial (baseada em 1)
                        const endPage = Math.min((docIndex + 1) * pagesPerDocument, totalPages); // Página final
                        
                        // Calcular a página onde está o texto para extração
                        const textPage = startPage + textPageOffset;
                        
                        // Verificar se a página de texto está dentro do intervalo válido
                        if (textPage > endPage) {
                            throw new Error(`A página de texto (${textPage}) está fora do intervalo válido para o documento ${docIndex + 1} (${startPage}-${endPage}).`);
                        }
                        
                        // Atualizar progresso
                        const progress = Math.round((docIndex / numDocuments) * 50);
                        progressFill.style.width = `${progress}%`;
                        progressText.textContent = `Extraindo texto do documento ${docIndex + 1}/${numDocuments}`;
                        progressPercent.textContent = `${progress}%`;
                        
                        // Permitir que a UI atualize
                        await new Promise(resolve => setTimeout(resolve, 10));
                        
                        // Extrair texto para o nome do arquivo
                        let docName = '';
                        try {
                            docName = await extractTextFromSelection(textPage, selectionCoordinates);
                            if (!docName) {
                                docName = `documento_${docIndex + 1}`;
                            }
                        } catch (error) {
                            console.warn(`Erro ao extrair texto para o documento ${docIndex + 1}:`, error);
                            docName = `documento_${docIndex + 1}`;
                        }
                        
                        // Limpar o nome do documento para uso em nome de arquivo
                        docName = sanitizeFilename(docName);
                        
                        // Processar cada página do documento
                        for (let pageNum = startPage; pageNum <= endPage; pageNum++) {
                            // Atualizar progresso
                            const pageProgress = 50 + Math.round(((pageNum - startPage) / (endPage - startPage + 1) + docIndex) / numDocuments * 50);
                            progressFill.style.width = `${pageProgress}%`;
                            progressText.textContent = `Processando página ${pageNum} do documento ${docIndex + 1}`;
                            progressPercent.textContent = `${pageProgress}%`;
                            
                            // Permitir que a UI atualize
                            await new Promise(resolve => setTimeout(resolve, 10));
                            
                            try {
                                // Criar PDF de página única usando o documento já carregado
                                const newPdfDoc = await PDFDocument.create();
                                const [copiedPage] = await newPdfDoc.copyPages(originalPdfDoc, [pageNum - 1]);
                                newPdfDoc.addPage(copiedPage);
                                
                                // Salvar o novo PDF
                                const pagePdfBytes = await newPdfDoc.save();
                                
                                // Gerar nome do arquivo
                                const pageInDoc = pageNum - startPage + 1;
                                const fileName = generateFileName(docName, pageInDoc);
                                
                                // Adicionar ao ZIP
                                zip.file(`${fileName}.pdf`, pagePdfBytes);
                                
                                // Armazenar o blob para download individual
                                const pdfBlob = new Blob([pagePdfBytes], { type: 'application/pdf' });
                                pdfBlobs[`${fileName}.pdf`] = pdfBlob;
                                
                                processedFiles.push({
                                    docIndex: docIndex + 1,
                                    pageNum,
                                    pageInDoc,
                                    fileName,
                                    docName
                                });
                            } catch (error) {
                                console.error(`Erro ao processar página ${pageNum}:`, error);
                                throw new Error(`Erro ao processar página ${pageNum}: ${error.message}`);
                            }
                        }
                    }
                    
                    // Finalizar progresso
                    progressFill.style.width = '100%';
                    progressText.textContent = 'Processamento concluído!';
                    progressPercent.textContent = '100%';
                    
                    // Mostrar resultados
                    displayResults();
                    
                    // Avançar para a etapa de download
                    setTimeout(() => {
                        step4.classList.add('hidden');
                        step5.classList.remove('hidden');
                    }, 500);
                } catch (error) {
                    console.error('Erro ao processar PDF:', error);
                    processingSuccess.classList.add('hidden');
                    processingError.classList.remove('hidden');
                    processingError.textContent = `Erro: ${error.message}`;
                    
                    // Avançar para a etapa de download mesmo com erro
                    setTimeout(() => {
                        step4.classList.add('hidden');
                        step5.classList.remove('hidden');
                    }, 500);
                }
            }

            // Função para gerar nome de arquivo
            function generateFileName(docName, pageInDoc) {
                let pattern = filenamePattern.value || '{text}_pagina{page}';
                
                // Substituir placeholders
                let fileName = pattern
                    .replace('{text}', docName)
                    .replace('{page}', pageInDoc);
                
                return fileName;
            }

            // Função para limpar nome de arquivo
            function sanitizeFilename(name) {
                // Remover caracteres inválidos para nome de arquivo
                return name.replace(/[<>:"/\\|?*]/g, '_')
                          .replace(/\s+/g, '_')
                          .substring(0, 100); // Limitar tamanho
            }

            // Função para exibir resultados
            function displayResults() {
                resultFiles.innerHTML = '';
                
                // Agrupar arquivos por documento
                const docGroups = {};
                
                processedFiles.forEach(file => {
                    if (!docGroups[file.docIndex]) {
                        docGroups[file.docIndex] = [];
                    }
                    docGroups[file.docIndex].push(file);
                });
                
                // Exibir arquivos agrupados por documento
                Object.keys(docGroups).forEach(docIndex => {
                    const files = docGroups[docIndex];
                    const docName = files[0].docName;
                    
                    // Criar cabeçalho do documento
                    const docHeader = document.createElement('div');
                    docHeader.className = 'alert alert-info';
                    docHeader.style.marginTop = '1rem';
                    docHeader.style.marginBottom = '0.5rem';
                    docHeader.textContent = `Documento ${docIndex}: ${docName}`;
                    resultFiles.appendChild(docHeader);
                    
                    // Listar arquivos do documento
                    files.forEach(file => {
                        const fileElement = document.createElement('div');
                        fileElement.className = 'result-file';
                        
                        // Adicionar link de download individual
                        const downloadLink = document.createElement('a');
                        downloadLink.className = 'download-individual';
                        downloadLink.textContent = 'Baixar';
                        downloadLink.href = '#';
                        downloadLink.addEventListener('click', (e) => {
                            e.preventDefault();
                            downloadSingleFile(`${file.fileName}.pdf`);
                        });
                        
                        fileElement.innerHTML = `
                            <span class="result-file-name">${file.fileName}.pdf</span>
                            <span class="result-file-pages">Página ${file.pageInDoc} de ${files.length}</span>
                        `;
                        
                        fileElement.appendChild(downloadLink);
                        resultFiles.appendChild(fileElement);
                    });
                });
            }

            // Função para baixar um único arquivo
            function downloadSingleFile(fileName) {
                try {
                    console.log(`Iniciando download do arquivo: ${fileName}`);
                    if (pdfBlobs[fileName]) {
                        saveAs(pdfBlobs[fileName], fileName);
                    } else {
                        console.error(`Arquivo não encontrado: ${fileName}`);
                        alert(`Erro: Arquivo ${fileName} não encontrado.`);
                    }
                } catch (error) {
                    console.error('Erro ao baixar arquivo individual:', error);
                    alert('Erro ao baixar o arquivo. Por favor, tente novamente.');
                }
            }

            // Função para baixar o ZIP
            async function downloadZip() {
                try {
                    console.log('Iniciando geração do arquivo ZIP...');
                    
                    // Verificar se há arquivos para baixar
                    if (processedFiles.length === 0) {
                        alert('Não há arquivos para baixar.');
                        return;
                    }
                    
                    // Gerar o arquivo ZIP
                    const zipBlob = await zip.generateAsync({
                        type: 'blob',
                        compression: 'DEFLATE',
                        compressionOptions: { level: 6 }
                    });
                    
                    console.log('Arquivo ZIP gerado com sucesso. Tamanho:', formatFileSize(zipBlob.size));
                    
                    // Obter nome do arquivo original
                    const originalFileName = pdfFileInput.files[0].name.replace('.pdf', '');
                    
                    // Baixar o arquivo ZIP usando FileSaver
                    console.log('Iniciando download do ZIP...');
                    saveAs(zipBlob, `${originalFileName}_renomeado.zip`);
                    console.log('Download iniciado com sucesso!');
                } catch (error) {
                    console.error('Erro ao gerar ou baixar arquivo ZIP:', error);
                    alert('Erro ao gerar arquivo ZIP. Por favor, tente novamente.');
                }
            }

            // Função para formatar o tamanho do arquivo
            function formatFileSize(bytes) {
                if (bytes === 0) return '0 Bytes';
                
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            }

            // Função para mostrar erro
            function showError(message) {
                alert(message);
            }

            // Função para resetar o aplicativo
            function resetApp() {
                // Resetar variáveis
                pdfDoc = null;
                pdfBytes = null;
                currentPage = 1;
                totalPages = 0;
                scale = 1.5;
                selectionCoordinates = null;
                processedFiles = [];
                pdfBlobs = {};
                zip = new JSZip();
                
                // Resetar interface
                pdfFileInput.value = '';
                fileInfo.classList.remove('active');
                fileName.textContent = '-';
                fileSize.textContent = '-';
                filePages.textContent = '-';
                continueToStep2.disabled = true;
                
                // Resetar campos
                pagesPerDocumentInput.value = '1';
                textPageNumberInput.value = '1';
                filenamePattern.value = '{text}_pagina{page}';
                
                // Limpar canvas
                const ctx = pdfCanvas.getContext('2d');
                ctx.clearRect(0, 0, pdfCanvas.width, pdfCanvas.height);
                
                // Resetar seleção
                clearSelection();
                
                // Resetar progresso
                progressFill.style.width = '0%';
                progressText.textContent = 'Preparando...';
                progressPercent.textContent = '0%';
                
                // Resetar resultados
                processingSuccess.classList.remove('hidden');
                processingError.classList.add('hidden');
                resultFiles.innerHTML = '';
            }

            console.log('Aplicação inicializada com sucesso!');
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9516449c80e0f1b1',t:'MTc1MDIwMjMyNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
